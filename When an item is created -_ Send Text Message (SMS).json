{"$schema":"https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#","contentVersion":"1.0.0.0","parameters":{"logicAppName":{"type":"String","metadata":{"description":"Name of the logic app."}},"logicAppLocation":{"defaultValue":"[resourceGroup().location]","allowedValues":["eastasia","southeastasia","centralus","eastus","eastus2","westus","northcentralus","southcentralus","northeurope","westeurope","japanwest","japaneast","brazilsouth","australiaeast","australiasoutheast","southindia","centralindia","westindia","canadacentral","canadaeast","westcentralus","westus2","[resourceGroup().location]"],"type":"String","metadata":{"description":"Location of the logic app."}},"twilio_Connection_Name":{"defaultValue":"twilio","type":"String","metadata":{"description":"Name of the connection."}},"sql_Connection_Name":{"defaultValue":"sql","type":"String","metadata":{"description":"Name of the connection."}}},"resources":[{"type":"Microsoft.Logic/workflows","name":"[parameters('logicAppName')]","apiVersion":"2016-06-01","location":"[parameters('logicAppLocation')]","properties":{"state":"Disabled","definition":{"$schema":"https://schema.management.azure.com/providers/Microsoft.Logic/schemas/2016-06-01/workflowdefinition.json#","contentVersion":"1.0.0.0","parameters":{"$connections":{"defaultValue":{},"type":"Object"},"$authentication":{"defaultValue":{},"type":"SecureObject"}},"triggers":{"When_an_item_is_created":{"recurrence":{"interval":1,"frequency":"Minute"},"splitOn":"@triggerBody()?['value']","metadata":{"flowSystemMetadata":{"swaggerOperationId":"GetOnNewItems"}},"type":"ApiConnection","inputs":{"host":{"connection":{"name":"@parameters('$connections')['sql']['connectionId']"}},"method":"get","path":"/datasets/default/tables/@{encodeURIComponent(encodeURIComponent('[dbo].[BitDullGradingSummary]'))}/onnewitems","authentication":"@parameters('$authentication')"}}},"actions":{"Send_Text_Message_(SMS)":{"runAfter":{},"metadata":{"flowSystemMetadata":{"swaggerOperationId":"SendMessage"}},"type":"ApiConnection","inputs":{"host":{"connection":{"name":"@parameters('$connections')['twilio']['connectionId']"}},"method":"post","body":{"from":"+15412303389","to":"+14053883988","body":"A recent bit analysis has exceeded the warning threshold. Bit Serial Number @{triggerBody()?['SerialNumber']} was graded @{triggerBody()?['result']}"},"path":"/Messages.json","authentication":"@parameters('$authentication')"}}},"outputs":{}},"parameters":{"$connections":{"value":{"twilio":{"id":"[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', parameters('logicAppLocation'), '/managedApis/', 'twilio')]","connectionId":"[resourceId('Microsoft.Web/connections', parameters('twilio_Connection_Name'))]","connectionName":"[parameters('twilio_Connection_Name')]"},"sql":{"id":"[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', parameters('logicAppLocation'), '/managedApis/', 'sql')]","connectionId":"[resourceId('Microsoft.Web/connections', parameters('sql_Connection_Name'))]","connectionName":"[parameters('sql_Connection_Name')]"}}}},"runtimeConfiguration":{"collections":{"maximumItemCount":100000},"performanceProfile":{"throttles":{"mode":"Medium"}}}},"dependsOn":["[resourceId('Microsoft.Web/connections', parameters('twilio_Connection_Name'))]","[resourceId('Microsoft.Web/connections', parameters('sql_Connection_Name'))]"]},{"type":"Microsoft.Web/connections","name":"[parameters('twilio_Connection_Name')]","apiVersion":"2016-06-01","location":"[parameters('logicAppLocation')]","properties":{"api":{"id":"[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', parameters('logicAppLocation'), '/managedApis/', 'twilio')]"},"displayName":"[parameters('twilio_Connection_Name')]"}},{"type":"Microsoft.Web/connections","name":"[parameters('sql_Connection_Name')]","apiVersion":"2016-06-01","location":"[parameters('logicAppLocation')]","properties":{"api":{"id":"[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', parameters('logicAppLocation'), '/managedApis/', 'sql')]"},"displayName":"[parameters('sql_Connection_Name')]"}}]}